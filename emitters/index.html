<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Execute PSR-15 RequestHandlerInterface instances and emit responses they generate.">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Emitters - zend-httphandlerrunner</title>

    <link rel="stylesheet" href="../css/styles-e3f3751b65.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    <div class="subnavigation hidden-print">
    <h4 class="subnavigation__title">
        <a href="..">zend-httphandlerrunner</a>
    </h4>

    <h5 class="subnavigation__subtitle">Table of Contents</h5>

    <ul class="subnavigation__list">
        
            
                <li class="subnavigation__list-item ">
                    <a href=".." class="subnavigation__link">zend-httphandlerrunner</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../intro/" class="subnavigation__link">Introduction</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../usage/" class="subnavigation__link">Usage</a>
                </li>
            
        
            
                <li class="subnavigation__list-item">
                    <span class="subnavigation__headline">Reference</span>
                    <ul class="subnavigation__list">
                        
                            
    <li class="subnavigation__list-item ">
        <a href="../runner/" class="subnavigation__link">Request Handler Runner</a>
    </li>

                        
                            
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Emitters</a>
    </li>

                        
                    </ul>
                </li>
            
        
    </ul>
</div>
                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-httphandlerrunner</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-httphandlerrunner/" class="header__link header__link--github" title="Go to repository of zend-httphandlerrunner">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="https://framework.zend.com/">Home</a></li>
  <li><a href="https://docs.zendframework.com/">Docs</a></li>
  <li><a href="..">zend-httphandlerrunner</a></li>
  
    
      
        <li>Reference</li>
      
    
  
  <li class="active">Emitters</li>
</ol>


    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#sapiemitter" class="toc__link">SapiEmitter</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#sapistreamemitter" class="toc__link">SapiStreamEmitter</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#emitterstack" class="toc__link">EmitterStack</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="emitters">Emitters</h1>
<p>Emitters are used to <em>emit</em> a <a href="https://www.php-fig.org/psr/psr-7">PSR-7</a>
response. This should generally happen when running under a traditional PHP
server API that uses output buffers, such as Apache or php-fpm.</p>
<p>Emitters are described by <code>Zend\HttpHandlerRunner\Emitter\EmitterInterface</code>:</p>
<pre class="codehilite"><code class="language-php">use Psr\Http\Message\ResponseInterface;

interface EmitterInterface
{
    public function emit(ResponseInterface $response) : bool;
}</code></pre>

<p>Typically, such emitters will perform the following:</p>
<ul>
<li>Emit a response status line.</li>
<li>Emit all response headers.</li>
<li>Emit the response body.</li>
</ul>
<p>(The first two items may be swapped in order; many SAPIs allow emitting multiple
status lines, and will use the last one present. As such, most implementations
will emit the status line after the headers to ensure the correct one is emitted
by the SAPI.)</p>
<p>The <code>emit()</code> method allows returning a boolean. This value can be checked to
determine if the emitter was able to emit the response. This capability is used
by the provided <code>EmitterStack</code> to allow composing multiple emitters that can
introspect the response to determine whether or not they are capable of emitting
it.</p>
<h2 id="sapiemitter">SapiEmitter</h2>
<p><code>Zend\HttpHandlerRunner\Emitter\SapiEmitter</code> accepts the response instance, and
uses the built-in PHP function <code>header()</code> to emit both the headers as well as
the status line. It then uses <code>echo</code> to emit the response body.</p>
<p>Internally, it also does a number of verifications:</p>
<ul>
<li>If headers have been previously sent, it will raise an exception.</li>
<li>If output has been previously sent, it will raise an exception.</li>
</ul>
<p>These are performed in order to ensure the integrity of the response emitted.</p>
<p>It also filters header names to normalize them; this is done in part to ensure
that if multiple headers of the same name are emitted, the SAPI will report them
correctly.</p>
<p>This emitter can <em>always</em> handle a response, and thus <em>always</em> returns true.</p>
<h2 id="sapistreamemitter">SapiStreamEmitter</h2>
<p><code>Zend\HttpHandlerRunner\Emitter\SapiStreamEmitter</code> behaves similarly to the
<code>SapiEmitter</code>, with two key differences:</p>
<ul>
<li>It allows emitting a a <em>content range</em>, if a <code>Content-Range</code> header is
  specified in the response.</li>
<li>It will iteratively emit a range of bytes from the response, based on the
  buffer length provided to the emitter during construction. This is
  particularly useful when returning <em>files</em> or <em>downloads</em>.</li>
</ul>
<p>The emitter accepts an integer argument to the constructor, indicating the
maximum buffer length; by default, this is 8192 bytes.</p>
<p>This emitter can <em>always</em> handle a response, and thus <em>always</em> returns true.</p>
<h2 id="emitterstack">EmitterStack</h2>
<p><code>Zend\HttpHandlerRunner\Emitter\EmitterStack</code> allows providing a
last-in-first-out (LIFO) stack of emitters instead of a single emitter. If an
emitter is incapable of handling the response and returns <code>false</code>, the stack
will move to the next emitter. If an emitter returns <code>true</code>, the stack
short-circuits and immediately returns.</p>
<p>The <code>EmitterStack</code> extends <code>SplStack</code>, and thus allows you to add emitters using
any of the methods that class defines; we recommend adding them in LIFO order
using <code>push()</code>:</p>
<pre class="codehilite"><code class="language-php">$stack-&gt;push($last);
$stack-&gt;push($second);
$stack-&gt;push($first);</code></pre>

<h3 id="conditionally-using-the-sapistreamemitter">Conditionally using the SapiStreamEmitter</h3>
<p>The <code>SapiStreamEmitter</code> is capable of emitting any response. However, for
in-memory responses, you may want to use the more efficient <code>SapiEmitter</code>. How
can you do this?</p>
<p>One way is to check for response artifacts that indicate a file download, such
as the <code>Content-Disposition</code> or <code>Content-Range</code> headers; if those headers are
not present, you could return <code>false</code> from the emitter, and otherwise continue.
You could achieve this by decorating the <code>SapiStreamEmitter</code>:</p>
<pre class="codehilite"><code class="language-php">$sapiStreamEmitter = new SapiStreamEmitter($maxBufferLength);
$conditionalEmitter = new class ($sapiStreamEmitter) implements EmitterInterface {
    private $emitter;

    public function __construct(EmitterInterface $emitter)
    {
        $this-&gt;emitter = $emitter;
    }

    public function emit(ResponseInterface) : bool
    {
        if (! $response-&gt;hasHeader('Content-Disposition')
            &amp;&amp; ! $response-&gt;hasHeader('Content-Range')
        ) {
            return false;
        }
        return $this-&gt;emitter-&gt;emit($response);
    }
};

$stack = new EmitterStack();
$stack-&gt;push(new SapiEmitter());
$stack-&gt;push($conditionalEmitter);</code></pre>

<p>In this way, you can have the best of both worlds, using the memory-efficient
<code>SapiStreamEmitter</code> for large file downloads or streaming buffers, and the
general-purpose <code>SapiEmitter</code> for everything else.</p>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../runner/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
        </li>
    </ul>
</nav>


<div class="help-wanted">
    <p>
        Found a mistake or want to contribute to the documentation?
        <a href="https://github.com/zendframework/zend-httphandlerrunner/edit/master/docs/emitters.md" target="_blank" class="help-wanted__link">
            Edit this page on GitHub!
        </a>
    </p>
</div>
                
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    <div class="subnavigation hidden-print">
    <h4 class="subnavigation__title">
        <a href="..">zend-httphandlerrunner</a>
    </h4>

    <h5 class="subnavigation__subtitle">Table of Contents</h5>

    <ul class="subnavigation__list">
        
            
                <li class="subnavigation__list-item ">
                    <a href=".." class="subnavigation__link">zend-httphandlerrunner</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../intro/" class="subnavigation__link">Introduction</a>
                </li>
            
        
            
                <li class="subnavigation__list-item ">
                    <a href="../usage/" class="subnavigation__link">Usage</a>
                </li>
            
        
            
                <li class="subnavigation__list-item">
                    <span class="subnavigation__headline">Reference</span>
                    <ul class="subnavigation__list">
                        
                            
    <li class="subnavigation__list-item ">
        <a href="../runner/" class="subnavigation__link">Request Handler Runner</a>
    </li>

                        
                            
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Emitters</a>
    </li>

                        
                    </ul>
                </li>
            
        
    </ul>
</div>
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2018 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '..',
            siteName = 'zend-httphandlerrunner';
    </script>
    <script src="../js/scripts-dcbafde59f.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
